<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>
<!-- xml 이름상관 없음. *.xml로 설정했으니까 -->
<!-- 이 xml이 어떤 interface와 연결되는지 설정 -->
<mapper namespace="com.quiz.bank.dao.AdminStudyDAO">

	<update id="deleteDetailCate" parameterType="hashmap">
	UPDATE detailed_subject_category SET del_flag = TRUE WHERE detailed_subject_cate_no = #{detailed_subject_cate_no}
	</update>
	<update id="deleteSubjectCate" parameterType="hashmap">
	UPDATE subject_category SET del_flag = TRUE WHERE subject_cate_no = #{subject_cate_no}
	</update>
	<update id="deleteTestCate" parameterType="hashmap">
	UPDATE test_category SET del_flag = TRUE WHERE test_cate_no = #{test_cate_no}
	</update>

	<select id="testCategoryCall" resultType="hashmap">
	SELECT * FROM test_category WHERE del_flag = false
	</select>
	<select id="subjectCategoryCall" resultType="hashmap">
	SELECT * FROM subject_category WHERE del_flag = false AND test_cate_no = #{upperCate}
	</select>
	<select id="detailSubjectCategoryCall" resultType="hashmap">
	SELECT * FROM detailed_subject_category WHERE del_flag = false AND subject_cate_no = #{upperCate}
	</select>
	
	
	<insert id="registTestCategory" parameterType="hashmap">
	INSERT INTO test_category (test_cate) VALUES (#{registCategory})
	</insert>
	<insert id="registSubjectCategory" parameterType="hashmap">
	INSERT INTO subject_category (subject_cate,test_cate_no) VALUES (#{registCategory},${upperCateNo})
	</insert>
	<insert id="registDetailSubject" parameterType="hashmap">
	INSERT INTO detailed_subject_category (detailed_subject_cate,subject_cate_no) VALUES (#{registCategory},${upperCateNo})
	</insert>
	
	<select id="overlayTestCate" parameterType="hashmap" resultType="int">
	SELECT COUNT(test_cate) FROM test_category WHERE test_cate = #{registCategory} AND del_flag = false
	</select>
	<select id="overlaySubjectCate" parameterType="hashmap" resultType="int">
	SELECT COUNT(subject_cate) FROM subject_category WHERE subject_cate = #{registCategory} AND test_cate_no = #{upperCateNo} AND del_flag = false
	</select>
	<select id="overlayDetailSubjectCate" parameterType="hashmap" resultType="int">
	SELECT COUNT(detailed_subject_cate) FROM detailed_subject_category WHERE detailed_subject_cate = #{registCategory} AND subject_cate_no =#{upperCateNo} AND del_flag = false
	</select>
	
	
	<!-- 대분류 삭제 -->
	<update id="deleteTestCategory" parameterType="hashmap">
	UPDATE (test_category t left JOIN subject_category sc USING (test_cate_no) left JOIN detailed_subject_category dsc USING (subject_cate_no))
	SET t.del_flag = true , sc.del_flag = true , dsc.del_flag = true WHERE test_cate_no = #{test_cate_no}
	</update>
	
	
	<!-- 중분류 삭제 -->
	<update id="deleteSubjectCategory" parameterType="hashmap">
	UPDATE (subject_category sc LEFT JOIN detailed_subject_category dsc USING (subject_cate_no))
	SET sc.del_flag =TRUE , dsc.del_flag = TRUE WHERE subject_cate_no = #{subject_cate_no}
	</update>
	
	<!-- 소분류 삭제 -->
	<update id="adminDeleteDetailedSubjectCategory" parameterType="hashmap">
	UPDATE detailed_subject_category SET del_flag = true WHERE detailed_subject_cate_no = #{detailed_subject_cate_no}
	</update>
	
	<select id="getTestCategoryName" parameterType="hashmap" resultType="string">
	SELECT test_cate FROM test_category WHERE test_cate_no = #{test_category}
	</select>
	
	<select id="getSubjectCategoryList" parameterType="hashmap" resultType="hashmap">
	SELECT subject_cate_no ,subject_cate FROM subject_category WHERE test_cate_no = #{test_category} AND del_flag = false; 
	</select>
	
	
</mapper>